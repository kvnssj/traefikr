{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$defs": {
    "stickyConfig": {
      "title": "Sticky Sessions",
      "type": "object",
      "properties": {
        "cookie": {
          "title": "Cookie",
          "type": "object",
          "properties": {
            "name": {
              "title": "Name",
              "type": "string",
              "description": "Custom cookie identifier"
            },
            "secure": {
              "title": "Secure",
              "type": "boolean",
              "description": "HTTPS-only flag"
            },
            "httpOnly": {
              "title": "HTTP Only",
              "type": "boolean",
              "description": "JavaScript access prevention"
            },
            "sameSite": {
              "title": "Same Site",
              "type": "string",
              "enum": ["none", "lax", "strict", ""],
              "description": "SameSite attribute for the cookie"
            },
            "maxAge": {
              "title": "Max Age",
              "type": "integer",
              "description": "Expiration duration in seconds"
            },
            "domain": {
              "title": "Domain",
              "type": "string",
              "description": "Cookie validity scope across subdomains"
            }
          }
        }
      },
      "description": "Enables sticky sessions with cookie-based affinity"
    },
    "loadBalancerHealthCheck": {
      "title": "Health Check",
      "type": "object",
      "properties": {
        "path": {
          "title": "Path",
          "default": "",
          "type": "string",
          "description": "Endpoint for health verification"
        },
        "scheme": {
          "title": "Scheme",
          "type": "string",
          "description": "Protocol override"
        },
        "mode": {
          "title": "Mode",
          "type": "string",
          "default": "http",
          "enum": ["grpc", "http"],
          "description": "Health check mode"
        },
        "hostname": {
          "title": "Hostname",
          "type": "string",
          "default": "",
          "description": "Custom Host header value"
        },
        "port": {
          "title": "Port",
          "type": "integer",
          "description": "Endpoint port override"
        },
        "interval": {
          "title": "Interval",
          "type": "string",
          "default": "30s",
          "description": "Check frequency (default: 30s)"
        },
        "unhealthyInterval": {
          "title": "Unhealthy Interval",
          "type": "string",
          "default": "30s",
          "description": "Failed server check rate"
        },
        "timeout": {
          "title": "Timeout",
          "type": "string",
          "default": "5s",
          "description": "Maximum wait duration (default: 5s)"
        },
        "headers": {
          "title": "Headers",
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Custom request headers"
        },
        "followRedirects": {
          "title": "Follow Redirects",
          "type": "boolean",
          "default": true,
          "description": "Follow redirects (default: true)"
        },
        "method": {
          "title": "Method",
          "type": "string",
          "default": "GET",
          "description": "HTTP verb (default: GET)"
        },
        "status": {
          "title": "Status",
          "type": "integer",
          "description": "Expected response code"
        }
      },
      "description": "Configures health check to remove unhealthy servers from the load balancing rotation"
    },
    "weightedHealthCheck": {
      "title": "Health Check",
      "type": "object",
      "description": "Activates health monitoring for child services"
    },
    "passiveHealthCheck": {
      "title": "Passive Health Check",
      "type": "object",
      "properties": {
        "failureWindow": {
          "title": "Failure Window",
          "type": "string",
          "default": "10s",
          "description": "Time window for failure assessment (default: 10s)"
        },
        "maxFailedAttempts": {
          "title": "Max Failed Attempts",
          "type": "integer",
          "default": 1,
          "description": "Consecutive failures threshold (default: 1)"
        }
      },
      "description": "Configures the passive health check to remove unhealthy servers from the load balancing rotation"
    }
  },
  "oneOf": [
    {
      "type": "object",
      "properties": {
        "loadBalancer": {
          "title": "Load Balancer",
          "type": "object",
          "properties": {
            "strategy": {
              "title": "Strategy",
              "type": "string",
              "enum": ["p2c", "leasttime"],
              "description": "Load balancing algorithm: p2c (power of two choices) or leasttime (lowest average response time)"
            },
            "servers": {
              "title": "Servers",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "url": {
                    "title": "URL",
                    "type": "string",
                    "description": "Backend instance endpoint"
                  },
                  "weight": {
                    "title": "Weight",
                    "type": "integer",
                    "description": "Load distribution ratio"
                  },
                  "preservePath": {
                    "title": "Preserve Path",
                    "type": "boolean",
                    "description": "Maintain URL path"
                  }
                },
                "required": ["url"]
              },
              "description": "Represents individual backend instances for your service"
            },
            "sticky": {
              "$ref": "#/$defs/stickyConfig"
            },
            "healthCheck": {
              "$ref": "#/$defs/loadBalancerHealthCheck"
            },
            "passiveHealthCheck": {
              "$ref": "#/$defs/passiveHealthCheck"
            },
            "passHostHeader": {
              "title": "Pass Host Header",
              "type": "boolean",
              "default": true,
              "description": "Allows forwarding of the client Host header to server"
            },
            "serversTransport": {
              "title": "Servers Transport",
              "type": "string",
              "default": "default@internal",
              "description": "Reference to an HTTP ServersTransport configuration for the communication between Traefik and your servers"
            },
            "responseForwarding": {
              "title": "Response Forwarding",
              "type": "object",
              "properties": {
                "flushInterval": {
                  "title": "Flush Interval",
                  "type": "string",
                  "description": "Specifies the interval in between flushes to the client while copying the response body (in milliseconds, default: 100ms)"
                }
              },
              "description": "Configures how Traefik forwards the response from the backend server to the client"
            }
          },
          "required": ["servers"],
          "additionalProperties": false
        }
      },
      "required": ["loadBalancer"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "weighted": {
          "title": "Weighted Round Robin",
          "type": "object",
          "properties": {
            "services": {
              "title": "Services",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "description": "The referenced service identifier"
                  },
                  "weight": {
                    "title": "Weight",
                    "type": "integer",
                    "description": "Numeric value determining traffic distribution ratio"
                  }
                },
                "required": ["name", "weight"]
              },
              "description": "Array of services with their traffic distribution weights"
            },
            "sticky": {
              "$ref": "#/$defs/stickyConfig"
            },
            "healthCheck": {
              "$ref": "#/$defs/weightedHealthCheck"
            },
            "passiveHealthCheck": {
              "$ref": "#/$defs/passiveHealthCheck"
            }
          },
          "required": ["services"],
          "additionalProperties": false,
          "description": "Weighted round robin service for load balancing between services"
        }
      },
      "required": ["weighted"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "mirroring": {
          "title": "Mirroring",
          "type": "object",
          "properties": {
            "service": {
              "title": "Service",
              "type": "string",
              "description": "The primary service receiving traffic"
            },
            "mirrorBody": {
              "title": "Mirror Body",
              "type": "boolean",
              "default": true,
              "description": "Controls whether request body is mirrored"
            },
            "maxBodySize": {
              "title": "Max Body Size",
              "type": "integer",
              "default": -1,
              "description": "Maximum body size for mirroring in bytes (default: -1 for unlimited)"
            },
            "mirrors": {
              "title": "Mirrors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "description": "Service identifier to mirror traffic to"
                  },
                  "percent": {
                    "title": "Percent",
                    "type": "integer",
                    "default": 0,
                    "description": "Integer percentage of requests to mirror (default: 0, meaning no traffic)"
                  }
                },
                "required": ["name"]
              },
              "description": "Array of mirror service definitions"
            },
            "sticky": {
              "$ref": "#/$defs/stickyConfig"
            },
            "healthCheck": {
              "$ref": "#/$defs/weightedHealthCheck"
            },
            "passiveHealthCheck": {
              "$ref": "#/$defs/passiveHealthCheck"
            }
          },
          "required": ["service"],
          "additionalProperties": false,
          "description": "Mirroring service for duplicating traffic to multiple services"
        }
      },
      "required": ["mirroring"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "failover": {
          "title": "Failover",
          "type": "object",
          "properties": {
            "service": {
              "title": "Service",
              "type": "string",
              "description": "The primary service that receives traffic initially"
            },
            "fallback": {
              "title": "Fallback",
              "type": "string",
              "description": "The backup service activated when the main service becomes unreachable"
            },
            "sticky": {
              "$ref": "#/$defs/stickyConfig"
            },
            "healthCheck": {
              "$ref": "#/$defs/weightedHealthCheck"
            },
            "passiveHealthCheck": {
              "$ref": "#/$defs/passiveHealthCheck"
            }
          },
          "required": ["service", "fallback"],
          "additionalProperties": false,
          "description": "Failover service for automatic failover to backup service"
        }
      },
      "required": ["failover"],
      "additionalProperties": false
    }
  ]
}
